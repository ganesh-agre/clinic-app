import{a as D,b as F,e as ie,f as se,h as re,j as I,k as ae}from"./chunk-R43FXMRF.js";import{j as $,k as w,m as O,o as _}from"./chunk-Z6GYEI4G.js";import{$a as T,Ca as x,Ha as b,I as q,Ja as Y,M as G,Ma as d,Ua as l,Va as r,W as h,Wa as i,X as C,Xa as B,ab as k,bb as E,eb as g,fa as J,fb as m,g as y,ia as Q,jb as A,lb as j,n as K,nb as c,o as z,ob as M,pb as S,qb as Z,ra as a,rb as ee,sb as te,tb as ne,u as U,vb as u,wa as X,wb as v,yb as oe}from"./chunk-25WXJ2TH.js";import"./chunk-2VMXMS7J.js";var me=Array.from({length:20},(o,t)=>({id:t+1,name:`User ${t+1}`,phone:`12345678${t+10}`,lastMessage:`Last message from User ${t+1}`,unread:Math.floor(Math.random()*5),messages:Array.from({length:50},(e,n)=>({from:n%2===0?"me":"them",text:`Message ${n+1} from ${n%2===0?"me":"them"} in conversation ${t+1}`,timestamp:Date.now()-(50-n)*6e4}))})),f=class o{conversationsSubject=new y(me);messagesSubject=new y([]);selectedConversationSubject=new y(null);getConversations(){return this.conversationsSubject.asObservable()}getMessages(){return this.messagesSubject.asObservable()}getSelectedConversation(){return this.selectedConversationSubject.asObservable()}selectConversation(t){t.unread=0,this.selectedConversationSubject.next(t),this.messagesSubject.next([...t.messages]),this.conversationsSubject.next([...this.conversationsSubject.getValue()])}sendMessage(t){let e=this.selectedConversationSubject.getValue();if(!e)return;let n={from:"me",text:t,timestamp:Date.now()};e.messages.push(n),e.lastMessage=t,this.messagesSubject.next([...e.messages]),this.conversationsSubject.next([...this.conversationsSubject.getValue()]),U(Math.random()*1e3+1e3).subscribe(()=>{let s={from:"them",text:`Auto reply to "${t}"`,timestamp:Date.now()};e.messages.push(s),e.lastMessage=s.text,this.selectedConversationSubject.getValue()?.id!==e.id&&(e.unread=(e.unread||0)+1),this.messagesSubject.next([...e.messages]),this.conversationsSubject.next([...this.conversationsSubject.getValue()])})}static \u0275fac=function(e){return new(e||o)};static \u0275prov=G({token:o,factory:o.\u0275fac,providedIn:"root"})};function pe(o,t){if(o&1&&(r(0,"span",8),c(1),i()),o&2){let e=m().$implicit;a(),M(e.unread)}}function de(o,t){if(o&1){let e=E();r(0,"div",2),u(1,"async"),g("click",function(){let s=h(e).$implicit,p=m();return C(p.select(s))}),r(2,"div",3),c(3),i(),r(4,"div",4)(5,"div",5),c(6),d(7,pe,2,1,"span",6),i(),r(8,"div",7),c(9),i()()()}if(o&2){let e,n=t.$implicit,s=m();j("active",n.id===((e=v(1,6,s.selectedConversation$))==null?null:e.id)),a(3),M(n.name[0]),a(3),S(" ",n.name," "),a(),l("ngIf",n.unread>0),a(2),M(n.lastMessage)}}var V=class o{constructor(t){this.messageService=t}serachTeaxtSubject=new y(null);set searchText(t){this.serachTeaxtSubject.next(t)}conversations$;selectedConversation$;ngOnInit(){let t=this.messageService.getConversations(),e=this.serachTeaxtSubject.asObservable();this.conversations$=z([t,e]).pipe(K(([n,s])=>s?n.filter(p=>p.name.toLowerCase().includes(s.toLowerCase())):n),q(n=>console.log("Filtered conversations:",n))),this.selectedConversation$=this.messageService.getSelectedConversation()}select(t){this.messageService.selectConversation(t)}static \u0275fac=function(e){return new(e||o)(x(f))};static \u0275cmp=b({type:o,selectors:[["app-conversation-list"]],inputs:{searchText:"searchText"},decls:3,vars:3,consts:[[1,"conversation-list"],["class","conversation-item",3,"active","click",4,"ngFor","ngForOf"],[1,"conversation-item",3,"click"],[1,"avatar"],[1,"conversation-info"],[1,"name"],["class","badge",4,"ngIf"],[1,"last-message"],[1,"badge"]],template:function(e,n){e&1&&(r(0,"div",0),d(1,de,10,8,"div",1),u(2,"async"),i()),e&2&&(a(),l("ngForOf",v(2,1,n.conversations$)))},dependencies:[_,$,w,I,O],styles:[".conversation-list[_ngcontent-%COMP%]{overflow-y:auto;height:400px}.conversation-item[_ngcontent-%COMP%]{display:flex;padding:10px;cursor:pointer;border-bottom:1px solid #f1f5f9}.conversation-item[_ngcontent-%COMP%]:hover{background:#f9fafb}.conversation-item.active[_ngcontent-%COMP%]{background:#e5f0ff}.badge[_ngcontent-%COMP%]{background:#ef4444;color:#fff;border-radius:12px;padding:2px 6px;font-size:12px;margin-left:8px}.avatar[_ngcontent-%COMP%]{width:36px;height:36px;background:#3b82f6;color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;margin-right:10px}"]})};var N=class o{constructor(t){this.el=t}appScrollBottom;atBottomChange=new X;ngOnChanges(){this.isNearBottom()&&this.scrollToBottom()}onScroll(){this.atBottomChange.emit(this.isNearBottom())}scrollToBottom(){let t=this.el.nativeElement;setTimeout(()=>{t.scrollTop=t.scrollHeight})}isNearBottom(){let t=this.el.nativeElement;return t.scrollHeight-t.scrollTop-t.clientHeight<20}static \u0275fac=function(e){return new(e||o)(x(Q))};static \u0275dir=Y({type:o,selectors:[["","appScrollBottom",""]],hostBindings:function(e,n){e&1&&g("scroll",function(){return n.onScroll()})},inputs:{appScrollBottom:"appScrollBottom"},outputs:{atBottomChange:"atBottomChange"},exportAs:["appScrollBottom"],features:[J]})};function ge(o,t){if(o&1&&(r(0,"div",12),c(1),i()),o&2){let e=t.$implicit;j("me",e.from==="me"),a(),S(" ",e.text," ")}}function ue(o,t){if(o&1){let e=E();r(0,"button",13),g("click",function(){h(e),m();let s=A(6);return C(s.scrollToBottom())}),c(1," \u2193 To Bottom "),i()}}function ve(o,t){if(o&1){let e=E();T(0),r(1,"div",4)(2,"h3"),c(3),i()(),r(4,"div",5)(5,"div",6,1),u(7,"async"),g("atBottomChange",function(s){h(e);let p=m();return C(p.atBottom=s)}),d(8,ge,2,3,"div",7),u(9,"async"),i(),d(10,ue,2,0,"button",8),i(),r(11,"div",9)(12,"input",10),te("ngModelChange",function(s){h(e);let p=m();return ee(p.draft,s)||(p.draft=s),C(s)}),g("keydown",function(s){h(e);let p=m();return C(p.onKeyPress(s))}),i(),r(13,"button",11),g("click",function(){h(e);let s=m();return C(s.send())}),c(14,"Send"),i()(),k()}if(o&2){let e=t.ngIf,n=m();a(3),M(e.name),a(2),l("appScrollBottom",v(7,5,n.messages$)),a(3),l("ngForOf",v(9,7,n.messages$)),a(2),l("ngIf",!n.atBottom),a(2),Z("ngModel",n.draft)}}function he(o,t){o&1&&(r(0,"div",14),c(1,"Select a conversation to start chatting"),i())}var W=class o{constructor(t){this.messageService=t}draft="";atBottom=!0;messages$;selectedConversation$;ngOnInit(){this.messages$=this.messageService.getMessages(),this.selectedConversation$=this.messageService.getSelectedConversation()}send(){this.draft.trim()&&(this.messageService.sendMessage(this.draft.trim()),this.draft="")}onKeyPress(t){t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),this.send())}static \u0275fac=function(e){return new(e||o)(x(f))};static \u0275cmp=b({type:o,selectors:[["app-chat-window"]],decls:5,vars:4,consts:[["emptyState",""],["scrollToBottomDirective","appScrollBottom"],[1,"chat"],[4,"ngIf","ngIfElse"],[1,"chat-header"],[1,"chat-messages-wrapper"],[1,"chat-messages",3,"atBottomChange","appScrollBottom"],["class","message",3,"me",4,"ngFor","ngForOf"],["class","scroll-btn",3,"click",4,"ngIf"],[1,"chat-input"],["type","text","placeholder","Type a message",3,"ngModelChange","keydown","ngModel"],[3,"click"],[1,"message"],[1,"scroll-btn",3,"click"],[1,"empty-state"]],template:function(e,n){if(e&1&&(r(0,"section",2),d(1,ve,15,9,"ng-container",3),u(2,"async"),d(3,he,2,0,"ng-template",null,0,oe),i()),e&2){let s=A(4);a(),l("ngIf",v(2,2,n.selectedConversation$))("ngIfElse",s)}},dependencies:[_,$,w,I,D,F,se,N,O],styles:[".chat[_ngcontent-%COMP%]{display:flex;flex-direction:column;background:#f9fafb;height:500px}.chat-header[_ngcontent-%COMP%]{flex:0 0 auto;padding:12px;border-bottom:1px solid #e5e7eb;background:#fff}.chat-messages-wrapper[_ngcontent-%COMP%]{flex:1 1 auto;overflow-y:hidden;position:relative;display:flex;flex-direction:column}.chat-messages[_ngcontent-%COMP%]{padding:12px;overflow-y:auto;position:relative;flex:1 1 auto}.scroll-btn[_ngcontent-%COMP%]{position:absolute;bottom:5%;right:5%;z-index:10}.message[_ngcontent-%COMP%]{max-width:60%;padding:8px 12px;margin-bottom:8px;background:#fff;border-radius:8px}.message.me[_ngcontent-%COMP%]{margin-left:auto;background:#3b82f6;color:#fff}.chat-input[_ngcontent-%COMP%]{flex:0 0 auto;display:flex;padding:10px;background:#fff;border-top:1px solid #e5e7eb}.chat-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{flex:1;padding:8px;border:1px solid #d1d5db;border-radius:4px}.chat-input[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:8px;padding:8px 12px;background:#3b82f6;color:#fff;border-radius:4px;border:none;cursor:pointer}.empty-state[_ngcontent-%COMP%]{margin:auto;color:#6b7280}"]})};function Ce(o,t){if(o&1&&(T(0),r(1,"h3"),c(2,"Patient Info"),i(),r(3,"p")(4,"strong"),c(5,"Name:"),i(),c(6),i(),r(7,"p")(8,"strong"),c(9,"Phone:"),i(),c(10),i(),k()),o&2){let e=t.ngIf;a(6),S(" ",e.name),a(4),S(" ",e.phone)}}var L=class o{constructor(t){this.messageService=t}selectedConversation$;ngOnInit(){this.selectedConversation$=this.messageService.getSelectedConversation()}static \u0275fac=function(e){return new(e||o)(x(f))};static \u0275cmp=b({type:o,selectors:[["app-info-panel"]],decls:3,vars:3,consts:[[1,"info"],[4,"ngIf"]],template:function(e,n){e&1&&(r(0,"aside",0),d(1,Ce,11,2,"ng-container",1),u(2,"async"),i()),e&2&&(a(),l("ngIf",v(2,1,n.selectedConversation$)))},dependencies:[_,w,I,O],styles:[".info[_ngcontent-%COMP%]{background:#fff;border-left:1px solid #e5e7eb;padding:12px}"]})};var le=class o{searchFormControl=new ie("");ngOnInit(){}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=b({type:o,selectors:[["app-messages"]],features:[ne([f])],decls:9,vars:2,consts:[[1,"messages-layout"],[1,"sidebar"],[1,"sidebar-header"],["type","text","placeholder","Search",1,"search-input",3,"formControl"],[3,"searchText"]],template:function(e,n){e&1&&(r(0,"div",0)(1,"aside",1)(2,"div",2)(3,"h2"),c(4,"Messages"),i(),B(5,"input",3),i(),B(6,"app-conversation-list",4),i(),B(7,"app-chat-window")(8,"app-info-panel"),i()),e&2&&(a(5),l("formControl",n.searchFormControl),a(),l("searchText",n.searchFormControl.value))},dependencies:[_,ae,D,F,re,V,W,L],styles:[".messages-layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:300px 1fr 300px;height:100%;background:#f3f4f6}.sidebar[_ngcontent-%COMP%]{background:#fff;border-right:1px solid #e5e7eb;display:flex;flex-direction:column;height:100%}.sidebar-header[_ngcontent-%COMP%]{padding:12px;border-bottom:1px solid #e5e7eb}.search-input[_ngcontent-%COMP%]{width:100%;padding:6px 8px;margin-top:8px;border:1px solid #d1d5db;border-radius:4px}"]})};export{le as MessageComponent};
